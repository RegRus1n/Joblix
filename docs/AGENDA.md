# Agenda — Большой спринт: Прогресс, Контент, Роутинг

**Дата:** Февраль 2026
**Ветка:** `dev`

---

## Что было сделано

### 1. Рефакторинг роутинга

**Было:**
`/profession/:professionId/simulation` — один маршрут для всего, SimulationLab сам решал, какой таск показывать (всегда `tasks[0]`)

**Стало:**
`/profession/:professionId/level/:levelId/task/:taskId` — полностью динамический маршрут

Теперь каждый таск имеет свой уникальный URL, что позволяет:
- Открывать конкретный таск по прямой ссылке
- Корректно работать с историей браузера (кнопка «Назад»)
- В будущем — синхронизировать прогресс с сервером по тому же ключу `(professionId, levelId, taskId)`

---

### 2. Контент: два полноценных уровня для SMM

Раньше контент был заглушкой. Теперь:

**Level 1 — «Целевая аудитория»** (`smm/level1.json`)
- Task 1: Теория «Что такое ЦА» → вопрос MultiChoice
- Task 2: Кейс «Онлайн-курсы по Python» → вопрос MultiChoice
- Task 3: Кейс «Кофейня с атмосферой» → задание CorrectOrder

**Level 2 — «Вовлечённость аудитории»** (`smm/level2.json`)
- Task 1: Теория «Что такое вовлечённость» → вопрос MultiChoice
- Task 2: Кейс «ER аккаунта упал» → вопрос MultiChoice
- Task 3: Теория «Типы контента» → задание CorrectOrder

Каждый таск = 1 звезда. Итого 3 звезды на уровень.

---

### 3. Контент для Frontend

**Frontend Level 1 — «Основы HTML»** (`frontend/level1.json`)
- Task 1: Что такое HTML → MultiChoice
- Task 2: Теги HTML → MultiChoice
- Task 3: Введение в CSS → CorrectOrder

Структура аналогична SMM — Frontend работает по той же системе.

---

### 4. Система прогресса (LocalStorage)

Новый файл `src/utils/progress.js` — единственное место работы с прогрессом.

**Функции:**
- `getProgress()` — получить весь прогресс
- `saveTaskResult(professionId, levelId, taskId, stars)` — сохранить результат (хранит максимум звёзд, не перезаписывает худшим)
- `isTaskUnlocked(professionId, levelId, taskId, levelData)` — таск N разблокирован, если таск N-1 завершён
- `isLevelUnlocked(professionId, levelIndex, allLevelsData)` — уровень N разблокирован, если task1 уровня N-1 завершён
- `getTotalStats()` — суммарно: сколько тасков пройдено, сколько звёзд заработано

**Когда сохраняется:** автоматически при попадании на финальный экран симуляции (`useEffect` при `isEnding === true`).

---

### 5. Система подсказок (Hints)

**Новый компонент:** `HintsPanel` — оверлей поверх симуляции.

**Поведение:**
- Кнопка `!` появляется только после первой ошибки на текущем вопросе
- Нет штрафа за просмотр подсказок
- Каждая подсказка — отдельный аккордеон (раскрывается по клику)
- Данные подсказок: поле `hints[]` в JSON каждой сцены-вопроса

---

### 6. Объяснение после сгорания звезды

Когда пользователь ошибся дважды на одном вопросе (звезда сгорает):
- В `WrongAnswerMessage` показывается блок «Объяснение» с текстом из поля `explanation` в JSON
- После этого пользователь переходит на следующую сцену без возможности пересдачи этого вопроса

---

### 7. Обновлён компонент `LevelTasks`

- **Первый таск** — показывает планету (Venus или Uranus, рандомно и стабильно через `useMemo`)
- **Разблокированный таск** — кликабельный круг, переходит на нужный URL
- **Заблокированный таск** — серый круг с иконкой замка, некликабельный
- **Звёзды под каждым таском** — отображают прогресс (заработанные подсвечены, незаработанные серые)

---

### 8. Обновлён компонент `LockedLevel`

- Принимает динамические `levelNumber` и `levelName`
- Показывает 3 звезды Star2.svg (серые — уровень не пройден)

---

### 9. Экран завершения (`Ending_template`)

Добавлена кнопка «К уровням» — `Link` на `/profession/:professionId`.
Принимает `professionId` как пропс из SimulationLab.

---

### 10. Проверка ответа через стрелку (MultiChoice)

Изменена логика MultiChoice:
- Клик на вариант → только выделение (не проверка)
- Можно переключить выбор до нажатия стрелки
- Стрелка становится активной при любом выборе
- Нажатие стрелки → проверка → ошибка или переход

---

## Файлы, созданные с нуля

| Файл | Назначение |
|------|-----------|
| `src/utils/progress.js` | Работа с LocalStorage прогрессом |
| `src/components/SimulationLab/components/HintsPanel/HintsPanel.jsx` | Панель подсказок |
| `src/components/SimulationLab/components/HintsPanel/HintsPanel.css` | Стили HintsPanel |
| `src/data/simulations/smm/level2.json` | Контент уровня 2 SMM |
| `src/data/simulations/frontend/level1.json` | Контент уровня 1 Frontend |

## Файлы, значительно изменённые

| Файл | Что изменилось |
|------|---------------|
| `src/App.jsx` | Новый маршрут |
| `src/components/SimulationLab/SimulationLab.jsx` | Переработан полностью |
| `src/pages/ProfessionLevels/ProfessionLevels.jsx` | Динамические уровни, прогресс |
| `src/components/LevelTasks/LevelTasks.jsx` | Планеты, навигация, звёзды |
| `src/components/LockedLevel/LockedLevel.jsx` | Динамические данные |
| `src/data/simulations/smm/level1.json` | Полноценный контент |
| `src/data/professions.json` | Названия уровней обновлены |
